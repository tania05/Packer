{
	"builders": [{
		"type": "virtualbox-ovf",
		"source_path": "bin/ubuntu_64_desktop/ubuntu_64_desktop.ovf",
		"ssh_username": "user",
		"ssh_password": "user",
		"headless": true,
		
		"shutdown_command": "echo 'user' | sudo -S shutdown -P now",
		"post_shutdown_delay": "10s",
		
		"output_directory": "bin/haskell",
		"vm_name": "haskell"
	}],
	
	"provisioners": [{
		"type": "file",
		"source": "cache/ideaIC-2017.1.4.tar.gz",
		"destination": "ideaIC-2017.1.4.tar.gz"
	}, {
		"type": "file",
		"source": "cache/intellij-haskell.zip",
		"destination": "intellij-haskell.zip"
	}, {
		"type": "shell",
		"inline": [

			"echo 'Install VBoxAdditions'",
			"mkdir mnt",
			"echo 'user' | sudo -S mount --source VBoxGuestAdditions.iso --target mnt",
			"echo 'user' | sudo -S mnt/VBoxLinuxAdditions.run || true",
			"echo 'user' | sudo -S umount mnt",
			"rmdir mnt",

			"echo 'Setting up IntelliJ'",
			"echo 'user' | sudo -S tar xf ideaIC-2017.1.4.tar.gz -C /opt/",
			"echo 'user' | sudo -S cp haskell-plugin.zip /opt/idea-IC-171.4694.23/plugins/haskell-plugin.zip",
			"echo 'Creating first time install script'",
			"mkdir Desktop",
			"touch ~/Desktop/runme.sh",
			"chmod +x ~/Desktop/runme.sh",
			"echo 'sudo /opt/idea-IC-171.4694.23/idea.sh' >> ~/Desktop/runme.sh",



			"echo 'Fixes for slow machines'",
			"echo 'user' | sudo -S rm --force /var/lib/dpkg/lock",
			"echo 'Running apt-get update'",
			"echo 'user' | sudo -S apt-get update",

			"echo 'Install zlib'",
			"echo 'user' | sudo -S apt-get install zlibc zlib1g zlib1g-dev",

			"echo 'Install Haskell/Cabal (Requires zlib already installed)'",
			"echo 'user' | sudo -S apt-get install calbal-install'",
			"cabal update",
			"cabal install cabal-install Cabal #update cabal, implicit dependency on zlib",
			"cabal install happy #depends on cabal",
			"cabal install ghc-mod #indirect dependency on happy",
			
			"#wget -qO- https://get.haskellstack.org/ > installhaskell.sh",
			"#chmod +x installhaskell.sh",
			"#echo 'user' | sudo -S ./installhaskell.sh",
			"#rm installhaskell.sh",
			"#stack setup",
			"#stack install ghc-mod",
			"#echo \"PATH=`stack path --compiler-bin`:\\$PATH\" >> ~/.profile",



			
			"echo 'Install vim'",
			"echo 'user' | sudo -S apt-get install vim -y",
			
			"echo 'Install git'",
			"echo 'user' | sudo -S apt-get install git -y"
		]
	}]
}
